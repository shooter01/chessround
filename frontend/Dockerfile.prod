# Dockerfile.prod ‚Äî production build for React + Vite

##################################
# 1) Build stage: —Å–æ–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ç–∏–∫—É
##################################
FROM node:20 AS builder
WORKDIR /app

# üëâ –î–æ–±–∞–≤–ª—è–µ–º build‚Äëarg –∏ –¥–µ–ª–∞–µ–º –µ–≥–æ –¥–æ—Å—Ç—É–ø–Ω—ã–º –¥–ª—è Vite
ARG VITE_API_URL
ENV VITE_API_URL=${VITE_API_URL}

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
COPY package.json package-lock.json ./
RUN npm ci

# –ö–æ–ø–∏—Ä—É–µ–º –∏—Å—Ö–æ–¥–Ω–∏–∫–∏ –∏ —Å–æ–±–∏—Ä–∞–µ–º prod‚Äë–±–∞–Ω–¥–ª
COPY . .
RUN npm run build

##################################
# 2) Serve stage: —Å–µ—Ä–≤–∏–º —á–µ—Ä–µ–∑ nginx
##################################
FROM nginx:alpine

# –ß–∏—Å—Ç–∏–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π html-–∫–æ–Ω—Ç–µ–Ω—Ç
RUN rm -rf /usr/share/nginx/html/*

# –ö–æ–ø–∏—Ä—É–µ–º –≥–æ—Ç–æ–≤—ã–π –±–∏–ª–¥
COPY --from=builder /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/conf.d/default.conf

# EXPOSE prod –ø–æ—Ä—Ç
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
